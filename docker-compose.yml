services:
  pkvault-backend:
    image: 'ghcr.io/dldri/pkvault-backend:latest'
    environment:
      - 'ASPNETCORE_URLS=http://0.0.0.0:5000'
      - ASPNETCORE_ENVIRONMENT=Development
    ports:
      - '5000:5000'
    volumes:
      - 'pkvault_db:/app/db'
      - 'pkvault_storage:/app/storage'
      - 'pkvault_config:/app/config'
      - '/home/ubuntu/ra-saves:/app/saves'
    restart: unless-stopped
    healthcheck:
      test:
        - CMD
        - curl
        - '-f'
        - 'http://0.0.0.0:5000/api/settings'
      interval: 30s
      timeout: 10s
      retries: 3
    labels:
      - "traefik.http.routers.http-0-nkco0wcggoow8408sw8go88w-pkvault-backend.priority=100"
      - "traefik.http.routers.https-0-nkco0wcggoow8408sw8go88w-pkvault-backend.priority=100"

  pkvault-frontend:
    image: 'ghcr.io/dldri/pkvault-frontend:latest'
    ports:
      - 5001:80
    restart: unless-stopped
    depends_on:
      - pkvault-backend
    labels:
      - "traefik.http.routers.http-0-nkco0wcggoow8408sw8go88w-pkvault-frontend.priority=10"
      - "traefik.http.routers.https-0-nkco0wcggoow8408sw8go88w-pkvault-frontend.priority=10"

volumes:
  pkvault_db: null
  pkvault_storage: null
  pkvault_config: null
